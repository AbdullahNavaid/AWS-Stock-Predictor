<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prediction Results</title>
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Lora', serif; background: #f4f4f4; padding: 20px; }
.container { max-width: 900px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
h1, h2 { text-align: center; margin-bottom: 20px; }
.budget-box { text-align: center; font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; }
.error { color: red; font-weight: bold; text-align: center; margin-top: 20px; }
.stock-data { display: flex; justify-content: center; gap: 40px; margin-bottom: 30px; }
.stock-data div { background: #fafafa; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
.stock-data div span.label { display: block; font-weight: 700; color: #333; margin-bottom: 5px; }
.stock-data div span.value { font-weight: 700; color: #000; font-size: 1.1rem; }
.back-link { text-align: center; margin-top: 30px; }
.back-link a { color: #000; text-decoration: none; font-weight: 700; }
.back-link a:hover { text-decoration: underline; }
</style>
</head>
<body>
<div class="container">
    <div class="back-link">
        <a href="index.html?budget=0">← Back to Stock List</a>
    </div>
    
    <h1 id="tickerTitle"></h1>
    <div class="budget-box" id="budgetDisplay"></div>
    <div class="error" id="errorMsg"></div>

    <div class="stock-data" id="latestData" style="display:none;">
        <div><span class="label">Open</span><span class="value" id="latestOpen"></span></div>
        <div><span class="label">High</span><span class="value" id="latestHigh"></span></div>
        <div><span class="label">Low</span><span class="value" id="latestLow"></span></div>
        <div><span class="label">Close</span><span class="value" id="latestPrice"></span></div>
        <div><span class="label">Volume</span><span class="value" id="latestVolume"></span></div>
    </div>

    <h2>Price Chart (Last 60 Days)</h2>
    <canvas id="priceChart" width="800" height="400"></canvas>

    <div class="back-link">
        <a href="index.html">← Back to Stock List</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const params = new URLSearchParams(window.location.search);
const ticker = params.get('ticker');
const budget = parseFloat(params.get('budget')) || 0;

document.getElementById('tickerTitle').textContent = ticker ? `Prediction for ${ticker}` : 'No Ticker Selected';
document.getElementById('budgetDisplay').textContent = `Budget: $${budget.toFixed(2)}`;

async function loadStockData() {
    if (!ticker) return;

    try {
        const response = await fetch('https://a3gp55veoh.execute-api.us-east-1.amazonaws.com/prod/stocks');
        const result = await response.json();
        const all_stocks = result.stocks || [];

        const stock = all_stocks.find(s => s.ticker === ticker);

        if (!stock || !stock.history || stock.history.length === 0) {
            document.getElementById('errorMsg').textContent = `No data found for ticker: ${ticker}`;
            return;
        }

        document.getElementById('latestData').style.display = 'flex';
        const latest = stock.history[stock.history.length - 1];
        document.getElementById('latestOpen').textContent = `$${latest.open.toFixed(2)}`;
        document.getElementById('latestHigh').textContent = `$${latest.high.toFixed(2)}`;
        document.getElementById('latestLow').textContent = `$${latest.low.toFixed(2)}`;
        document.getElementById('latestPrice').textContent = `$${latest.close.toFixed(2)}`;
        document.getElementById('latestVolume').textContent = latest.volume.toLocaleString();

        // Chart.js line chart
        const ctx = document.getElementById('priceChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: stock.history.map(d => d.date),
                datasets: [
                    { label: 'Close Price', data: stock.history.map(d => d.close), borderColor: 'blue', fill: false, tension: 0.1 },
                    { label: 'High Price', data: stock.history.map(d => d.high), borderColor: 'green', fill: false, tension: 0.1 },
                    { label: 'Low Price', data: stock.history.map(d => d.low), borderColor: 'red', fill: false, tension: 0.1 }
                ]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top' } },
                scales: {
                    x: { display: true, title: { display: true, text: 'Date' } },
                    y: { display: true, title: { display: true, text: 'Price ($)' } }
                }
            }
        });

    } catch (err) {
        console.error(err);
        document.getElementById('errorMsg').textContent = `Error loading stock data: ${err.message}`;
    }
}

loadStockData();
</script>
</body>
</html>
