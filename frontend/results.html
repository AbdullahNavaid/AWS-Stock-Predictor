<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prediction Results</title>
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap" rel="stylesheet">
<style>
/* Universal box-sizing and reset for consistent spacing */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/* Body styling with serif font and light gray background */
body { 
    font-family: 'Lora', serif; 
    background: #f4f4f4; 
    padding: 20px; 
}

/* Adds slightly transparent dollar sign background overlay */
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('https://user-gen-media-assets.s3.amazonaws.com/seedream_images/1094f6e9-3992-4761-8aed-6d2ec1daf0ab.png') no-repeat center center;
    background-size: cover;
    opacity: 0.1; /* lower = more transparent */
    z-index: 0;
}

/* Main container: centered, white card with shadow */
.container { 
    position: relative;
    z-index: 1;
    max-width: 900px; 
    margin: 0 auto; 
    background: #fff;  /* fully opaque background */
    padding: 30px; 
    border-radius: 10px; 
    box-shadow: 0 5px 20px rgba(0,0,0,0.1); 
}

/* Centered headings with bottom margin */
h1, h2 { 
    text-align: center; 
    margin-bottom: 20px; 
}

/* Centered budget display box with bold text */
.budget-box { 
    text-align: center; 
    font-size: 1.2rem; 
    font-weight: bold; 
    margin-bottom: 20px; 
}

/* Error message styling: red text, bold, centered */
.error { 
    color: red; 
    font-weight: bold; 
    text-align: center; 
    margin-top: 20px; 
}

/* Stock data container: flexbox layout with gap between items */
.stock-data { 
    display: flex; 
    justify-content: center; 
    gap: 40px; 
    margin-bottom: 30px; 
}

/* Individual stock data card styling */
.stock-data div { 
    background: #fafafa; 
    padding: 15px; 
    border-radius: 8px; 
    text-align: center; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
}

/* Label styling within stock data cards */
.stock-data div span.label { 
    display: block; 
    font-weight: 700; 
    color: #333; 
    margin-bottom: 5px; 
}

/* Value styling within stock data cards */
.stock-data div span.value { 
    font-weight: 700; 
    color: #000; 
    font-size: 1.1rem; 
}

/* Back link container styling */
.back-link { 
    text-align: center; 
    margin-top: 30px; 
}

/* Back link styling: black text, bold, underline on hover */
.back-link a { 
    color: #000; 
    text-decoration: none; 
    font-weight: 700; 
}

.back-link a:hover { 
    text-decoration: underline; 
}
</style>
</head>
<body>
<div class="container">
    <!-- Navigation link to return to stock list -->
    <div class="back-link">
        <a href="#" id="backLink">‚Üê Back to Stock List</a>
    </div>
    
    <!-- Page title showing selected ticker -->
    <h1 id="tickerTitle"></h1>
    
    <!-- Budget display area, populated by JavaScript -->
    <div class="budget-box" id="budgetDisplay"></div>
    
    <!-- Error message container, shown if data loading fails -->
    <div class="error" id="errorMsg"></div>

    <!-- Stock data cards showing latest prices and volume -->
    <div class="stock-data" id="latestData" style="display:none;">
        <div><span class="label">Open</span><span class="value" id="latestOpen"></span></div>
        <div><span class="label">High</span><span class="value" id="latestHigh"></span></div>
        <div><span class="label">Low</span><span class="value" id="latestLow"></span></div>
        <div><span class="label">Close</span><span class="value" id="latestPrice"></span></div>
        <div><span class="label">Volume</span><span class="value" id="latestVolume"></span></div>
    </div>

    <!-- Section header for price chart -->
    <h2>Price Chart (Last 60 Days)</h2>
    
    <!-- Canvas element for Chart.js line chart -->
    <canvas id="priceChart" width="800" height="400"></canvas>
</div>

<!-- Chart.js library for creating interactive charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Get ticker and budget from URL query parameters
const params = new URLSearchParams(window.location.search);
const ticker = params.get('ticker');
const budget = parseFloat(params.get('budget')) || 0;

// Display ticker name and budget in page header
document.getElementById('tickerTitle').textContent = ticker ? `${ticker}` : 'No Ticker Selected';
document.getElementById('budgetDisplay').textContent = `Budget: $${budget.toFixed(2)}`;

// Set the back link with the correct budget parameter
document.getElementById('backLink').href = `index.html?budget=${encodeURIComponent(budget)}`;

/**
 * Fetches stock data from API and displays chart and latest prices.
 * Finds the selected ticker's data and renders a Chart.js line chart.
 */
async function loadStockData() {
    if (!ticker) return;

    try {
        // Fetch all stock data from API
        const response = await fetch('https://a3gp55veoh.execute-api.us-east-1.amazonaws.com/prod/stocks');
        const result = await response.json();
        const all_stocks = result.stocks || [];

        // Find the stock matching the selected ticker
        const stock = all_stocks.find(s => s.ticker === ticker);

        // Show error if stock not found or has no history
        if (!stock || !stock.history || stock.history.length === 0) {
            document.getElementById('errorMsg').textContent = `No data found for ticker: ${ticker}`;
            return;
        }

        // Display latest stock data in cards
        document.getElementById('latestData').style.display = 'flex';
        const latest = stock.history[stock.history.length - 1];
        document.getElementById('latestOpen').textContent = `$${latest.open.toFixed(2)}`;
        document.getElementById('latestHigh').textContent = `$${latest.high.toFixed(2)}`;
        document.getElementById('latestLow').textContent = `$${latest.low.toFixed(2)}`;
        document.getElementById('latestPrice').textContent = `$${latest.close.toFixed(2)}`;
        document.getElementById('latestVolume').textContent = latest.volume.toLocaleString();

        // Create Chart.js line chart showing close, high, and low prices over time
        const ctx = document.getElementById('priceChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: stock.history.map(d => d.date),
                datasets: [
                    { label: 'Close Price', data: stock.history.map(d => d.close), borderColor: 'blue', fill: false, tension: 0.1 },
                    { label: 'High Price', data: stock.history.map(d => d.high), borderColor: 'green', fill: false, tension: 0.1 },
                    { label: 'Low Price', data: stock.history.map(d => d.low), borderColor: 'red', fill: false, tension: 0.1 }
                ]
            },
            options: {
                responsive: true,
                plugins: { 
                    legend: { 
                        position: 'top',
                        title: {
                            display: true,
                            text: 'Sort by:',
                            position: 'left',
                            font: { weight: 'bold' },
                            padding: { top: 10, right: 20, bottom: 0, left: 0 }
                        }
                    } 
                },
                scales: {
                    x: { display: true, title: { display: true, text: 'Date' } },
                    y: { display: true, title: { display: true, text: 'Price ($)' } }
                }
            }
        });

    } catch (err) {
        // Display error message if API fetch or processing fails
        console.error(err);
        document.getElementById('errorMsg').textContent = `Error loading stock data: ${err.message}`;
    }
}

// Initialize page by loading stock data
loadStockData();
</script>
</body>
</html>
